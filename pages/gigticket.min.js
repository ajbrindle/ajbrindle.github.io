const promoter=document.getElementById("promoter"),bandName=document.getElementById("band-name"),bandOther=document.getElementById("band-other"),venue=document.getElementById("venue"),address=document.getElementById("venue-address"),gigDateTime=document.getElementById("gig-date-time"),price=document.getElementById("price"),typeSelect=document.getElementById("type-select"),sizeSlider=document.getElementById("size"),fadeSlider=document.getElementById("fade"),colorPicker=document.getElementById("color-picker"),
colorBox=document.getElementById("chosen-color"),gigSelect=document.getElementById("gig-select"),downloadButton=document.getElementById("download-button"),divToCapture=document.getElementById("full-ticket");var currentElement,relatedElement,currentTemplate=1,dateWarningShown=!1,storeOnComplete=!1,clearOnComplete=!0;const ticketBandNames=document.querySelectorAll('p[id*="ticket-band-"]');
function resizeComponents(){const a=document.getElementById("ticket-band-name-"+currentTemplate),b=document.getElementById("ticket-band-other-"+currentTemplate);a.style.fontSize<=b.style.fontSize&&fitText(b,getFontSizeVal(a)-2)}const resizeObserver=new ResizeObserver(resizeComponents);ticketBandNames.forEach(a=>{resizeObserver.observe(a)});
document.addEventListener("DOMContentLoaded",function(){var a=[0,1,2,3,4,6,7,8,12,13,14,15,16,17,18,19,20,21];const b="font"+a[Math.floor(Math.random()*a.length)];document.querySelectorAll('p[id*="ticket-band-"]').forEach(e=>{e.style.fontFamily=window.getComputedStyle(document.getElementById(b)).fontFamily});const c=document.getElementById("dropdown-button"),d=document.getElementById("dropdown-menu");a=document.querySelectorAll(".dropdown-item");c.addEventListener("click",function(){d.classList.toggle("show")});
a.forEach(e=>{e.addEventListener("click",function(){c.style.fontFamily=window.getComputedStyle(document.getElementById(this.id)).fontFamily;requestAnimationFrame(()=>setFontAndResize(this.id));d.classList.remove("show")})});window.addEventListener("click",function(e){e.target.matches(".dropdown-toggle")||d.classList.contains("show")&&d.classList.remove("show")});a=Math.ceil(window.innerWidth/52);document.getElementById("ticket-price-6").style.marginTop=a+"px";document.getElementById("ticket-band-name-6").style.marginTop=
a+"px"});gigSelect.addEventListener("change",function(){setPresets(this.value)});colorPicker.addEventListener("input",function(){const a=colorPicker.value;currentElement.style.color=a;null!==relatedElement&&(relatedElement.style.color=a);setOverrideData(document.getElementById("apply-colour"),colorPicker.value)});promoter.addEventListener("input",function(){let a=document.getElementById("ticket-promoter-"+currentTemplate);null!==a&&(a.innerHTML=promoter.value,fitText(a,22))});
bandName.addEventListener("input",function(){let a=document.getElementById("ticket-band-name-"+currentTemplate);null!==a&&(a.innerHTML=bandName.value,fitText(a,64))});bandOther.addEventListener("input",function(){let a=document.getElementById("ticket-band-other-"+currentTemplate);null!==a&&(a.innerHTML=bandOther.value,fitText(a,48))});
venue.addEventListener("input",function(){let a=document.getElementById("ticket-venue-"+currentTemplate);null!==a&&(4!==currentTemplate?(a.innerHTML=venue.value,fitText(a,36)):(a.innerHTML=venue.value.split("").map(b=>b.toUpperCase()).join(" ").replaceAll(" ","&nbsp;"),fitText(a,28)))});address.addEventListener("input",function(){let a=document.getElementById("ticket-address-"+currentTemplate);null!==a&&(a.innerHTML=address.value,fitText(a,32))});
price.addEventListener("input",function(){let a=document.getElementById("ticket-price-"+currentTemplate);null!==a&&(a.innerHTML=price.value,fitText(a,28))});
gigDateTime.addEventListener("input",function(){let a=document.getElementById("ticket-date-time-"+currentTemplate),b=document.querySelector('[name="gig-date-time"]').value;formatDateTime(b);fitText(a,20);requestAnimationFrame(()=>document.getElementById("ticket-doors-"+currentTemplate).style.fontSize=a.style.fontSize);new Date(b)>new Date?(document.getElementById("not-ticket").style.display="inline",dateWarningShown||(document.getElementById("date-warning").style.display="block",dateWarningShown=
!0)):document.getElementById("not-ticket").style.display="none"});typeSelect.addEventListener("change",function(){let a=this.value;"none"===this.value?a="":a.includes("SEATING")&&(a=a.includes("VIP")?a+(" - Row "+getRandomLetter(0,3)+", Seat "+getRandomNumber(50)):a+(" - Row "+getRandomLetter(3,25)+", Seat "+getRandomNumber(250)));const b=document.getElementById("ticket-type-"+currentTemplate);b.innerHTML=a;fitText(b,24)});
sizeSlider.addEventListener("input",function(){fitText(currentElement,sizeSlider.value);null!==relatedElement&&requestAnimationFrame(()=>relatedElement.style.fontSize=currentElement.style.fontSize)});fadeSlider.addEventListener("input",function(){currentElement.style.opacity=fadeSlider.value/100;null!==relatedElement&&requestAnimationFrame(()=>relatedElement.style.opacity=currentElement.style.opacity)});
downloadButton.addEventListener("click",function(){html2canvas(divToCapture,{useCORS:!0}).then(a=>{a=a.toDataURL("image/png");const b=document.createElement("a");b.href=a;b.download="ticket.png";document.body.appendChild(b);b.click();document.body.removeChild(b)})});
function changeTemplate(a){currentTemplate=a;var b="url('../images/background"+a+".jpeg')";document.getElementById("full-ticket").style.backgroundImage=b;for(b=1;6>=b;b++)document.getElementById("content-box-"+b).style.display="none";document.getElementById("content-box-"+a).style.display="flex";document.getElementById("colour1").style.backgroundImage="url('../images/template-thumbs/background"+a+".jpeg')";document.getElementById("colour2").style.backgroundImage="url('../images/template-thumbs/background"+
a+"b.jpeg')";document.getElementById("colour3").style.backgroundImage="url('../images/template-thumbs/background"+a+"c.jpeg')";document.getElementById("colour4").style.backgroundImage="url('../images/template-thumbs/background"+a+"d.jpeg')";document.getElementById("colour5").style.backgroundImage="url('../images/template-thumbs/background"+a+"e.jpeg')";document.getElementById("price-row").hidden=null===document.getElementById("ticket-price-"+a);document.getElementById("address-row").hidden=null===
document.getElementById("ticket-address-"+a);6===currentTemplate&&(document.getElementById("ticket-band-name-6").style.fontFamily=window.getComputedStyle(document.getElementById("font21")).fontFamily);document.getElementById("promoter-row").hidden=6===currentTemplate;document.getElementById("support-row").hidden=6===currentTemplate;document.getElementById("venue-row").hidden=6===currentTemplate;document.getElementById("show-doors-row").hidden=6===currentTemplate;document.getElementById("type-row").hidden=
6===currentTemplate;document.getElementById("font-dropdown").style.display=6===currentTemplate?"none":"block";dispatchEvents();setOverrideData()}
function setOverrideData(a=null,b=null){var c="ticket-promoter- ticket-band-name- ticket-band-other- ticket-date-time- ticket-doors- ticket-venue- ticket-address- ticket-type- ticket-price-".split(" ");for(const d of c)c=document.getElementById(d+currentTemplate),null!==c&&(null===a?null!==c.getAttribute("data-font-size")&&(c.style.fontSize=c.getAttribute("data-font-size")):a.checked&&(c.style.color=b))}
function swapBackground(a){document.getElementById("full-ticket").style.backgroundImage="url('../images/background"+currentTemplate+a+".jpeg')"}function fitText(a,b){6===currentTemplate&&(b=20);a.style.fontSize=`${b}pt`;storeOnComplete?a.setAttribute("data-font-size",`${b}pt`):clearOnComplete&&a.removeAttribute("data-font-size");requestAnimationFrame(()=>shrinkStep(a,b))}
function shrinkStep(a,b){let c=0,d=document.getElementById("inner-content-box-"+currentTemplate);null===d&&(d=document.getElementById("content-box-"+currentTemplate),c=40);for(;a.scrollWidth>d.clientWidth-c&&1<b;)b--,a.style.fontSize=`${b}pt`,storeOnComplete?a.setAttribute("data-font-size",`${b}pt`):clearOnComplete&&a.removeAttribute("data-font-size"),requestAnimationFrame(()=>shrinkStep(a,b))}
function setFontAndResize(a){currentElement.style.fontFamily=window.getComputedStyle(document.getElementById(a)).fontFamily;fitText(currentElement,getFontSizeVal(currentElement));null!==relatedElement&&requestAnimationFrame(()=>setRelatedFontAndSize(a))}
function setRelatedFontAndSize(a){relatedElement.style.fontFamily=window.getComputedStyle(document.getElementById(a)).fontFamily;relatedElement.style.fontSize=currentElement.style.fontSize;storeOnComplete&&relatedElement.setAttribute("data-font-size",currentElement.style.fontSize)}function getFontSizeVal(a){return 6===currentElement?20:a.style.fontSize.replace(/[^0-9]+?$/,"")}
function rgb2hex(a){var b=a.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(!b)return"#000000";a=parseInt(b[1],10).toString(16).padStart(2,"0");const c=parseInt(b[2],10).toString(16).padStart(2,"0");b=parseInt(b[3],10).toString(16).padStart(2,"0");return`#${a}${c}${b}`}function doAge(a){a.checked?document.getElementById("content-box-"+currentTemplate).classList.remove("content-box-no-after"):document.getElementById("content-box-"+currentTemplate).classList.add("content-box-no-after")}
function showDoors(a){a.checked?document.getElementById("ticket-doors-"+currentTemplate).style.display="block":document.getElementById("ticket-doors-"+currentTemplate).style.display="none"}function showBookingFee(a){const b=document.getElementById("ticket-fee");a.checked?(b.style.display="block",b.style.top=Math.floor(26*Math.random())+35+"%",b.style.left=Math.floor(26*Math.random())+"%",b.style.transform="rotate("+(Math.floor(171*Math.random())-85)+"deg)"):b.style.display="none"}
function formatDateTime(a){if(!a)return"Please select a date and time.";var b=new Date(a);a=b.getDate();const c=getDayWithOrdinal(a),d=(new Intl.DateTimeFormat("en-GB",{weekday:"long"})).format(b),e=(new Intl.DateTimeFormat("en-GB",{month:"long"})).format(b),f=b.getFullYear(),g=b.getMonth()+1;b=(new Intl.DateTimeFormat("en-GB",{hour:"numeric",minute:"numeric",hour12:!0})).format(b);6===currentTemplate?document.getElementById("ticket-date-time-"+currentTemplate).innerHTML=`${a} . ${g} . ${f}`:(document.getElementById("ticket-date-time-"+
currentTemplate).innerHTML=`${d} ${c} ${e} ${f}`,document.getElementById("ticket-doors-"+currentTemplate).innerHTML=`Doors ${b.toLowerCase()}`)}function getDayWithOrdinal(a){if(3<a&&21>a)return`${a}th`;switch(a%10){case 1:return`${a}st`;case 2:return`${a}nd`;case 3:return`${a}rd`;default:return`${a}th`}}
function showSettings(a,b,c=null){currentElement=document.getElementById(a+"-"+currentTemplate);relatedElement=null!==c?document.getElementById(c+"-"+currentTemplate):null;document.getElementById("dropdown-button").style.fontFamily=currentElement.style.fontFamily;document.getElementById("size").max=b;document.getElementById("size").value=getFontSizeVal(currentElement);document.getElementById("color-picker").value=rgb2hex(currentElement.style.color);a=currentElement.style.opacity;document.getElementById("fade").value=
.1>a?80:100*currentElement.style.opacity;document.getElementById("settings").style.display="flex";document.getElementById("apply-colour").checked=!1;storeOnComplete=!0;return!1}function closeModal(a){document.getElementById(a).style.display="none";storeOnComplete=!1;return!0}
function setPresets(a){var b=document.getElementById(a+"-data"),c=b.getAttribute("data-promoter");let d=b.getAttribute("data-band"),e=b.getAttribute("data-other"),f=b.getAttribute("data-dt"),g=b.getAttribute("data-venue"),h=b.getAttribute("data-address");a=b.getAttribute("data-type");b=b.getAttribute("data-price");promoter.value=c;bandName.value=d;bandOther.value=e;venue.value=g;address.value=h;gigDateTime.value=f;price.value=b;for(c=0;c<typeSelect.length;c++)if(typeSelect.options[c].value===a){typeSelect.selectedIndex=
c;break}dispatchEvents()}function dispatchEvents(){var a=new Event("input"),b=new Event("change");clearOnComplete=!1;0<promoter.value.length&&promoter.dispatchEvent(a);0<bandName.value.length&&bandName.dispatchEvent(a);0<bandOther.value.length&&bandOther.dispatchEvent(a);0<venue.value.length&&venue.dispatchEvent(a);0<address.value.length&&address.dispatchEvent(a);gigDateTime.dispatchEvent(a);typeSelect.dispatchEvent(b);0<price.value.length&&price.dispatchEvent(a);clearOnComplete=!0}
function getRandomLetter(a,b){return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(Math.random()*(b-a+1))+a]}function getRandomNumber(a){return Math.floor(Math.random()*a)+1};
